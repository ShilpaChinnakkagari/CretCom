{% extends "base.html" %}

{% block title %}Analytics - CretCom{% endblock %}

{% block navigation %}
    <a href="/principal/dashboard">📊 Dashboard</a>
    <a href="/principal/user-management">👥 User Management</a>
    <a href="/principal/finance-management">💰 Finance</a>
    <a href="/principal/department-management">🏫 Departments</a>
    <a href="/principal/analytics">📈 Analytics</a>
    <a href="/logout">🚪 Logout</a>
{% endblock %}

{% block content %}
<h1>College Analytics</h1>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
    <!-- STUDENT ANALYTICS -->
    <div style="background: white; padding: 20px; border-radius: 10px;">
        <h3>🎓 Student Analytics</h3>
        {% if student_stats %}
        <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
            <thead>
                <tr style="background: #34495e; color: white;">
                    <th style="padding: 12px; text-align: left;">Department</th>
                    <th style="padding: 12px; text-align: center;">Attendance</th>
                    <th style="padding: 12px; text-align: center;">Avg CGPA</th>
                    <th style="padding: 12px; text-align: center;">Students</th>
                </tr>
            </thead>
            <tbody>
                {% for stat in student_stats %}
                <tr style="border-bottom: 1px solid #ddd;">
                    <td style="padding: 12px;"><strong>{{ stat.department }}</strong></td>
                    <td style="padding: 12px; text-align: center;">
                        <span style="color: {% if stat.avg_attendance >= 75 %}#27ae60{% elif stat.avg_attendance >= 60 %}#f39c12{% else %}#e74c3c{% endif %};">
                            {{ "%.1f"|format(stat.avg_attendance or 0) }}%
                        </span>
                    </td>
                    <td style="padding: 12px; text-align: center;">
                        <span style="color: {% if stat.avg_cgpa >= 8.0 %}#27ae60{% elif stat.avg_cgpa >= 7.0 %}#f39c12{% else %}#e74c3c{% endif %};">
                            {{ "%.2f"|format(stat.avg_cgpa or 0) }}
                        </span>
                    </td>
                    <td style="padding: 12px; text-align: center;">{{ stat.student_count }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p style="text-align: center; color: #7f8c8d; padding: 20px;">No student analytics data available</p>
        {% endif %}
    </div>

    <!-- FACULTY ANALYTICS -->
    <div style="background: white; padding: 20px; border-radius: 10px;">
        <h3>👨‍🏫 Faculty Analytics</h3>
        {% if faculty_stats %}
        <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
            <thead>
                <tr style="background: #34495e; color: white;">
                    <th style="padding: 12px; text-align: left;">Department</th>
                    <th style="padding: 12px; text-align: center;">Faculty Count</th>
                    <th style="padding: 12px; text-align: center;">Status</th>
                </tr>
            </thead>
            <tbody>
                {% for stat in faculty_stats %}
                <tr style="border-bottom: 1px solid #ddd;">
                    <td style="padding: 12px;"><strong>{{ stat.department }}</strong></td>
                    <td style="padding: 12px; text-align: center;">
                        <span style="color: {% if stat.faculty_count >= 10 %}#27ae60{% elif stat.faculty_count >= 5 %}#f39c12{% else %}#e74c3c{% endif %};">
                            {{ stat.faculty_count }}
                        </span>
                    </td>
                    <td style="padding: 12px; text-align: center;">
                        <span style="color: {% if stat.faculty_count >= 10 %}#27ae60{% elif stat.faculty_count >= 5 %}#f39c12{% else %}#e74c3c{% endif %};">
                            {% if stat.faculty_count >= 10 %}Excellent
                            {% elif stat.faculty_count >= 5 %}Good
                            {% else %}Need More Faculty
                            {% endif %}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p style="text-align: center; color: #7f8c8d; padding: 20px;">No faculty analytics data available</p>
        {% endif %}
    </div>
</div>

<!-- SUMMARY STATISTICS -->
<div style="background: white; padding: 20px; border-radius: 10px; margin-top: 20px;">
    <h3>📊 Summary Statistics</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 15px;">
        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <div style="font-size: 1.5em; font-weight: bold; color: #2c3e50;">
                {{ student_stats|sum(attribute='student_count') or 0 }}
            </div>
            <div style="color: #7f8c8d;">Total Students</div>
        </div>
        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <div style="font-size: 1.5em; font-weight: bold; color: #2c3e50;">
                {{ faculty_stats|sum(attribute='faculty_count') or 0 }}
            </div>
            <div style="color: #7f8c8d;">Total Faculty</div>
        </div>
        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <div style="font-size: 1.5em; font-weight: bold; color: #2c3e50;">
                {{ "%.1f"|format((student_stats|map(attribute='avg_attendance')|sum / student_stats|length) if student_stats else 0) }}%
            </div>
            <div style="color: #7f8c8d;">Overall Attendance</div>
        </div>
        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <div style="font-size: 1.5em; font-weight: bold; color: #2c3e50;">
                {{ "%.2f"|format((student_stats|map(attribute='avg_cgpa')|sum / student_stats|length) if student_stats else 0) }}
            </div>
            <div style="color: #7f8c8d;">Overall CGPA</div>
        </div>
    </div>
</div>

<!-- PERFORMANCE INDICATORS -->
<div style="background: white; padding: 20px; border-radius: 10px; margin-top: 20px;">
    <h3>📈 Performance Indicators</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
        <div style="border-left: 4px solid #27ae60; padding: 10px 15px; background: #f8f9fa;">
            <strong>Top Performing Department</strong><br>
            <span style="color: #7f8c8d;">
                {% if student_stats %}
                    {{ (student_stats|sort(attribute='avg_cgpa', reverse=true)|first).department }}
                    (CGPA: {{ "%.2f"|format((student_stats|sort(attribute='avg_cgpa', reverse=true)|first).avg_cgpa) }})
                {% else %}No data{% endif %}
            </span>
        </div>
        <div style="border-left: 4px solid #3498db; padding: 10px 15px; background: #f8f9fa;">
            <strong>Best Attendance</strong><br>
            <span style="color: #7f8c8d;">
                {% if student_stats %}
                    {{ (student_stats|sort(attribute='avg_attendance', reverse=true)|first).department }}
                    ({{ "%.1f"|format((student_stats|sort(attribute='avg_attendance', reverse=true)|first).avg_attendance) }}%)
                {% else %}No data{% endif %}
            </span>
        </div>
        <div style="border-left: 4px solid #f39c12; padding: 10px 15px; background: #f8f9fa;">
            <strong>Largest Department</strong><br>
            <span style="color: #7f8c8d;">
                {% if student_stats %}
                    {{ (student_stats|sort(attribute='student_count', reverse=true)|first).department }}
                    ({{ (student_stats|sort(attribute='student_count', reverse=true)|first).student_count }} students)
                {% else %}No data{% endif %}
            </span>
        </div>
    </div>
</div>
{% endblock %}